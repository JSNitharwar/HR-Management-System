<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HR Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <?!= include('Stylesheet'); ?>
</head>
<body>
  <div class="app-container">
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2><i class="material-icons">apartment</i> HR System</h2>
      </div>
      <ul class="nav-menu">
        <li class="nav-item active" data-section="dashboard">
          <i class="material-icons">dashboard</i>
          <span>Dashboard</span>
        </li>
        <li class="nav-item" data-section="employees">
          <i class="material-icons">badge</i>
          <span>Employees</span>
        </li>
        <li class="nav-item" data-section="recruitment">
          <i class="material-icons">person_search</i>
          <span>Candidates</span>
        </li>
        <li class="nav-item" data-section="jobs">
          <i class="material-icons">work</i>
          <span>Job Postings</span>
        </li>
        <li class="nav-item" data-section="interviews">
          <i class="material-icons">event</i>
          <span>Interviews</span>
        </li>
        <li class="nav-item" data-section="offers">
          <i class="material-icons">description</i>
          <span>Offer Letters</span>
        </li>
        <li class="nav-item" data-section="settings">
          <i class="material-icons">settings</i>
          <span>Settings</span>
        </li>
      </ul>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
      
      <!-- Header -->
      <header class="header">
        <button class="menu-toggle" onclick="toggleSidebar()">
          <i class="material-icons">menu</i>
        </button>
        <h1 id="page-title">Dashboard</h1>
        <div class="header-actions">
          <select id="entity-filter" class="entity-select" onchange="filterByEntity()">
            <option value="">All Entities</option>
            <? if(legalEntities && legalEntities.length > 0) { ?>
              <? for(var i = 0; i < legalEntities.length; i++) { ?>
                <option value="<?= legalEntities[i]['Entity Name'] ?>"><?= legalEntities[i]['Entity Name'] ?></option>
              <? } ?>
            <? } ?>
          </select>
        </div>
      </header>

      <!-- Dashboard Section -->
      <section id="dashboard-section" class="section active">
        <div class="stats-grid">
          <div class="stat-card" style="--card-color:#667eea;--card-color-end:#764ba2;">
            <div class="stat-icon blue"><i class="material-icons">people</i></div>
            <div class="stat-info">
              <span class="stat-value" id="total-employees">0</span>
              <span class="stat-label">Total Employees</span>
            </div>
          </div>
          <div class="stat-card" style="--card-color:#11998e;--card-color-end:#38ef7d;">
            <div class="stat-icon green"><i class="material-icons">check_circle</i></div>
            <div class="stat-info">
              <span class="stat-value" id="active-employees">0</span>
              <span class="stat-label">Active Employees</span>
            </div>
          </div>
          <div class="stat-card" style="--card-color:#f093fb;--card-color-end:#f5576c;">
            <div class="stat-icon orange"><i class="material-icons">pending</i></div>
            <div class="stat-info">
              <span class="stat-value" id="pending-onboarding">0</span>
              <span class="stat-label">Pending Onboarding</span>
            </div>
          </div>
          <div class="stat-card" style="--card-color:#4facfe;--card-color-end:#00f2fe;">
            <div class="stat-icon purple"><i class="material-icons">work</i></div>
            <div class="stat-info">
              <span class="stat-value" id="open-positions">0</span>
              <span class="stat-label">Open Positions</span>
            </div>
          </div>
        </div>

        <div class="dashboard-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;">
          <div class="card">
            <div class="card-header">
              <h3><i class="material-icons" style="font-size:20px;vertical-align:middle;margin-right:8px;color:#667eea;">flash_on</i>Quick Actions</h3>
            </div>
            <div class="card-body">
              <div class="quick-actions" style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
                <button class="btn btn-primary" onclick="showAddEmployeeModal()">
                  <i class="material-icons">person_add</i> Add Employee
                </button>
                <button class="btn btn-success" onclick="showCreateJobModal()">
                  <i class="material-icons">work</i> Post Job
                </button>
                <button class="btn btn-warning" onclick="showAddCandidateModal()">
                  <i class="material-icons">person_search</i> Add Candidate
                </button>
                <button class="btn btn-secondary" onclick="navigateToSection('offers')">
                  <i class="material-icons">description</i> Offer Letters
                </button>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3><i class="material-icons" style="font-size:20px;vertical-align:middle;margin-right:8px;color:#11998e;">event</i>Today's Interviews</h3>
            </div>
            <div class="card-body">
              <div id="todays-interviews">
                <p class="empty-message" style="text-align:center;color:#888;padding:20px;">Loading...</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Employees Section -->
      <section id="employees-section" class="section">
        <div class="section-header">
          <h2>Employee Management</h2>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showAddEmployeeModal()">
              <i class="material-icons">person_add</i> Add Employee
            </button>
            <button class="btn btn-secondary" onclick="showBulkUploadModal()">
              <i class="material-icons">upload_file</i> Bulk Upload
            </button>
            <button class="btn btn-warning" onclick="sendBulkRemindersAction()">
              <i class="material-icons">notifications</i> Send Reminders
            </button>
          </div>
        </div>

        <div class="filters">
          <select id="emp-status-filter" onchange="filterEmployees()">
            <option value="">All Status</option>
            <option value="Invited">Invited</option>
            <option value="Form Pending">Form Pending</option>
            <option value="Documents Pending">Documents Pending</option>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
          <select id="emp-dept-filter" onchange="filterEmployees()">
            <option value="">All Departments</option>
          </select>
          <input type="text" id="emp-search" placeholder="ðŸ” Search employees..." oninput="filterEmployees()">
        </div>

        <div class="table-container">
          <table class="data-table" id="employees-table">
            <thead>
              <tr>
                <th><input type="checkbox" id="select-all-emp" onchange="toggleSelectAllEmployees()"></th>
                <th>Employee ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="employees-tbody">
              <tr><td colspan="8" class="loading-cell">Loading employees...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Recruitment Section -->
      <section id="recruitment-section" class="section">
        <div class="section-header">
          <h2>Candidate Management</h2>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showAddCandidateModal()">
              <i class="material-icons">person_add</i> Add Candidate
            </button>
          </div>
        </div>

        <div class="filters">
          <select id="cand-job-filter" onchange="filterCandidates()">
            <option value="">All Jobs</option>
          </select>
          <select id="cand-status-filter" onchange="filterCandidates()">
            <option value="">All Status</option>
            <option value="Applied">Applied</option>
            <option value="Screening">Screening</option>
            <option value="Interview Scheduled">Interview Scheduled</option>
            <option value="Interviewed">Interviewed</option>
            <option value="Selected">Selected</option>
            <option value="Offer Sent">Offer Sent</option>
            <option value="Offer Accepted">Offer Accepted</option>
            <option value="Rejected">Rejected</option>
          </select>
          <input type="text" id="cand-search" placeholder="ðŸ” Search candidates..." oninput="filterCandidates()">
        </div>

        <div class="table-container">
          <table class="data-table" id="candidates-table">
            <thead>
              <tr>
                <th>Candidate ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Applied For</th>
                <th>Experience</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="candidates-tbody">
              <tr><td colspan="8" class="loading-cell">Loading candidates...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Jobs Section -->
      <section id="jobs-section" class="section">
        <div class="section-header">
          <h2>Job Postings</h2>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showCreateJobModal()">
              <i class="material-icons">add</i> Create Job Posting
            </button>
          </div>
        </div>

        <div class="jobs-grid" id="jobs-grid">
          <p class="loading-cell">Loading jobs...</p>
        </div>
      </section>

      <!-- Interviews Section -->
      <section id="interviews-section" class="section">
        <div class="section-header">
          <h2>Interview Schedule</h2>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showScheduleInterviewModal()">
              <i class="material-icons">event</i> Schedule Interview
            </button>
          </div>
        </div>

        <div class="filters">
          <input type="date" id="int-date-from" onchange="filterInterviews()">
          <input type="date" id="int-date-to" onchange="filterInterviews()">
          <select id="int-status-filter" onchange="filterInterviews()">
            <option value="">All Status</option>
            <option value="Scheduled">Scheduled</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
          </select>
        </div>

        <div class="table-container">
          <table class="data-table" id="interviews-table">
            <thead>
              <tr>
                <th>Interview ID</th>
                <th>Candidate</th>
                <th>Position</th>
                <th>Date</th>
                <th>Time</th>
                <th>Interviewer</th>
                <th>Type</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="interviews-tbody">
              <tr><td colspan="9" class="loading-cell">Loading interviews...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Offers Section (NEW) -->
      <section id="offers-section" class="section">
        <div class="section-header">
          <h2>Offer Letters</h2>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showCreateOfferModal()">
              <i class="material-icons">note_add</i> Create Offer
            </button>
          </div>
        </div>

        <div class="filters">
          <select id="offer-status-filter" onchange="filterOffers()">
            <option value="">All Status</option>
            <option value="Draft">Draft</option>
            <option value="Sent">Sent</option>
            <option value="Accepted">Accepted</option>
            <option value="Rejected">Rejected</option>
            <option value="Expired">Expired</option>
            <option value="Withdrawn">Withdrawn</option>
          </select>
          <input type="text" id="offer-search" placeholder="ðŸ” Search offers..." oninput="filterOffers()">
        </div>

        <div class="table-container">
          <table class="data-table" id="offers-table">
            <thead>
              <tr>
                <th>Offer ID</th>
                <th>Candidate</th>
                <th>Position</th>
                <th>CTC</th>
                <th>Joining Date</th>
                <th>Offer Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="offers-tbody">
              <tr><td colspan="8" class="loading-cell">Loading offers...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings-section" class="section">
        <div class="section-header">
          <h2>Settings</h2>
        </div>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;">
          <div class="card">
            <div class="card-header">
              <h3><i class="material-icons" style="font-size:20px;vertical-align:middle;margin-right:8px;color:#667eea;">business</i>Legal Entities</h3>
              <button class="btn btn-sm btn-primary" onclick="showAddEntityModal()">
                <i class="material-icons">add</i> Add
              </button>
            </div>
            <div class="card-body">
              <div style="margin-bottom:15px;">
                <select id="entity-status-filter" onchange="loadEntities()" style="padding:8px 12px;border:2px solid #e8e8e8;border-radius:8px;">
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                  <option value="">All</option>
                </select>
              </div>
              <div id="entities-list" class="entities-list">
                <p class="loading-cell">Loading entities...</p>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3><i class="material-icons" style="font-size:20px;vertical-align:middle;margin-right:8px;color:#11998e;">build</i>System Actions</h3>
            </div>
            <div class="card-body">
              <div style="display:flex;flex-direction:column;gap:12px;">
                <button class="btn btn-secondary" onclick="initializeSystem()" style="justify-content:flex-start;">
                  <i class="material-icons">settings</i> Initialize Sheets
                </button>
                <button class="btn btn-secondary" onclick="exportEmployeeData()" style="justify-content:flex-start;">
                  <i class="material-icons">download</i> Export Employee Data
                </button>
                <button class="btn btn-secondary" onclick="refreshAllData()" style="justify-content:flex-start;">
                  <i class="material-icons">refresh</i> Refresh All Data
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- ============================================
       MODAL: Add Employee
       ============================================ -->
  <div id="add-employee-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-bg">
          <h2><i class="material-icons">person_add</i> Add New Employee</h2>
          <p>Enter basic information to onboard a new employee</p>
          <button class="close-btn" onclick="closeModal('add-employee-modal')">&times;</button>
        </div>
      </div>
      <form id="add-employee-form" onsubmit="submitNewEmployee(event)">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label><i class="material-icons">business</i> Legal Entity *</label>
              <select id="emp-entity" name="legalEntity" required>
                <option value="">Select Entity</option>
                <? if(legalEntities && legalEntities.length > 0) { ?>
                  <? for(var i = 0; i < legalEntities.length; i++) { ?>
                    <option value="<?= legalEntities[i]['Entity Name'] ?>"><?= legalEntities[i]['Entity Name'] ?></option>
                  <? } ?>
                <? } ?>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">badge</i> First Name *</label>
              <input type="text" id="emp-first-name" name="firstName" required placeholder="Enter first name">
            </div>
            <div class="form-group">
              <label><i class="material-icons">badge</i> Last Name *</label>
              <input type="text" id="emp-last-name" name="lastName" required placeholder="Enter last name">
            </div>
            <div class="form-group">
              <label><i class="material-icons">email</i> Personal Email *</label>
              <input type="email" id="emp-email" name="personalEmail" required placeholder="employee@email.com">
            </div>
            <div class="form-group">
              <label><i class="material-icons">phone</i> Phone Number *</label>
              <input type="tel" id="emp-phone" name="phone" required pattern="[0-9]{10}" placeholder="10 digit number">
            </div>
            <div class="form-group">
              <label><i class="material-icons">credit_card</i> Aadhar Number</label>
              <input type="text" id="emp-aadhar" name="aadharNumber" pattern="[0-9]{12}" placeholder="12 digit Aadhar">
            </div>
            <div class="form-group">
              <label><i class="material-icons">credit_card</i> PAN Number</label>
              <input type="text" id="emp-pan" name="panNumber" style="text-transform:uppercase" placeholder="ABCDE1234F">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('add-employee-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="material-icons">send</i> Add & Send Welcome Email
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: Add Candidate
       ============================================ -->
  <div id="add-candidate-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#11998e,#38ef7d);">
          <h2><i class="material-icons">person_search</i> Add Candidate</h2>
          <p>Add a new candidate for recruitment</p>
          <button class="close-btn" onclick="closeModal('add-candidate-modal')">&times;</button>
        </div>
      </div>
      <form id="add-candidate-form" onsubmit="submitNewCandidate(event)">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group full-width">
              <label><i class="material-icons">work</i> Job Position *</label>
              <select id="cand-job" name="jobId" required>
                <option value="">Select Job</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">badge</i> First Name *</label>
              <input type="text" id="cand-first-name" name="firstName" required placeholder="Enter first name">
            </div>
            <div class="form-group">
              <label><i class="material-icons">badge</i> Last Name *</label>
              <input type="text" id="cand-last-name" name="lastName" required placeholder="Enter last name">
            </div>
            <div class="form-group">
              <label><i class="material-icons">email</i> Email *</label>
              <input type="email" id="cand-email" name="email" required placeholder="candidate@email.com">
            </div>
            <div class="form-group">
              <label><i class="material-icons">phone</i> Phone *</label>
              <input type="tel" id="cand-phone" name="phone" required pattern="[0-9]{10}" placeholder="10 digit number">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('add-candidate-modal')">Cancel</button>
          <button type="submit" class="btn btn-success">
            <i class="material-icons">send</i> Add & Send Application Form
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: Create Job
       ============================================ -->
  <div id="create-job-modal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#f093fb,#f5576c);">
          <h2><i class="material-icons">work</i> Create Job Posting</h2>
          <p>Define job details and requirements</p>
          <button class="close-btn" onclick="closeModal('create-job-modal')">&times;</button>
        </div>
      </div>
      <form id="create-job-form" onsubmit="submitNewJob(event)">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label><i class="material-icons">business</i> Legal Entity *</label>
              <select id="job-entity" name="legalEntity" required>
                <option value="">Select Entity</option>
                <? if(legalEntities && legalEntities.length > 0) { ?>
                  <? for(var i = 0; i < legalEntities.length; i++) { ?>
                    <option value="<?= legalEntities[i]['Entity Name'] ?>"><?= legalEntities[i]['Entity Name'] ?></option>
                  <? } ?>
                <? } ?>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">title</i> Job Title *</label>
              <input type="text" id="job-title" name="jobTitle" required placeholder="e.g., Software Engineer">
            </div>
            <div class="form-group">
              <label><i class="material-icons">category</i> Department *</label>
              <input type="text" id="job-department" name="department" required placeholder="e.g., Engineering">
            </div>
            <div class="form-group">
              <label><i class="material-icons">location_on</i> Location *</label>
              <input type="text" id="job-location" name="location" required placeholder="e.g., Mumbai">
            </div>
            <div class="form-group">
              <label><i class="material-icons">schedule</i> Employment Type *</label>
              <select id="job-type" name="employmentType" required>
                <option value="Full-time">Full-time</option>
                <option value="Part-time">Part-time</option>
                <option value="Contract">Contract</option>
                <option value="Intern">Intern</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">trending_up</i> Experience Required</label>
              <input type="text" id="job-experience" name="experienceRequired" placeholder="e.g., 3-5 years">
            </div>
            <div class="form-group">
              <label><i class="material-icons">payments</i> Salary Range</label>
              <input type="text" id="job-salary" name="salaryRange" placeholder="e.g., 10-15 LPA">
            </div>
            <div class="form-group">
              <label><i class="material-icons">group</i> Positions</label>
              <input type="number" id="job-positions" name="numberOfPositions" value="1" min="1">
            </div>
            <div class="form-group full-width">
              <label><i class="material-icons">description</i> Job Description *</label>
              <textarea id="job-description" name="description" rows="4" required placeholder="Describe the role and responsibilities..."></textarea>
            </div>
            <div class="form-group full-width">
              <label><i class="material-icons">checklist</i> Requirements</label>
              <textarea id="job-requirements" name="requirements" rows="4" placeholder="List key requirements and qualifications..."></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('create-job-modal')">Cancel</button>
          <button type="submit" class="btn btn-warning">
            <i class="material-icons">publish</i> Post Job
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: Schedule Interview
       ============================================ -->
  <div id="schedule-interview-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#4facfe,#00f2fe);">
          <h2><i class="material-icons">event</i> Schedule Interview</h2>
          <p>Set up interview details and send invitations</p>
          <button class="close-btn" onclick="closeModal('schedule-interview-modal')">&times;</button>
        </div>
      </div>
      <form id="schedule-interview-form" onsubmit="submitScheduleInterview(event)">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group full-width">
              <label><i class="material-icons">person</i> Candidate *</label>
              <select id="int-candidate" name="candidateId" required>
                <option value="">Select Candidate</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">format_list_numbered</i> Interview Round</label>
              <select id="int-round" name="round">
                <option value="1">Round 1 - HR Screening</option>
                <option value="2">Round 2 - Technical</option>
                <option value="3">Round 3 - Managerial</option>
                <option value="4">Round 4 - Final</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">videocam</i> Interview Type *</label>
              <select id="int-type" name="interviewType" required>
                <option value="Video Call">Video Call</option>
                <option value="Phone">Phone</option>
                <option value="In-person">In-person</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">calendar_today</i> Date *</label>
              <input type="date" id="int-date" name="interviewDate" required>
            </div>
            <div class="form-group">
              <label><i class="material-icons">access_time</i> Time *</label>
              <input type="time" id="int-time" name="interviewTime" required>
            </div>
            <div class="form-group">
              <label><i class="material-icons">timelapse</i> Duration</label>
              <select id="int-duration" name="duration">
                <option value="30 minutes">30 minutes</option>
                <option value="45 minutes">45 minutes</option>
                <option value="60 minutes" selected>60 minutes</option>
                <option value="90 minutes">90 minutes</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="material-icons">email</i> Interviewer Email *</label>
              <input type="email" id="int-interviewer-email" name="interviewerEmail" required placeholder="interviewer@company.com">
            </div>
            <div class="form-group">
              <label><i class="material-icons">person</i> Interviewer Name *</label>
              <input type="text" id="int-interviewer-name" name="interviewerName" required placeholder="Interviewer's name">
            </div>
            <div class="form-group full-width">
              <label><i class="material-icons">link</i> Meeting Link (optional)</label>
              <input type="url" id="int-meeting-link" name="meetingLink" placeholder="https://meet.google.com/...">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('schedule-interview-modal')">Cancel</button>
          <button type="submit" class="btn btn-primary" style="background:linear-gradient(135deg,#4facfe,#00f2fe);">
            <i class="material-icons">send</i> Schedule & Send Invites
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: Create Offer Letter (NEW)
       ============================================ -->
  <div id="create-offer-modal" class="modal">
    <div class="modal-content modal-xl">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#0f0c29,#302b63);">
          <h2><i class="material-icons">description</i> Create Offer Letter</h2>
          <p>Generate and send offer letter to selected candidate</p>
          <button class="close-btn" onclick="closeModal('create-offer-modal')">&times;</button>
        </div>
      </div>
      <form id="create-offer-form" onsubmit="submitCreateOffer(event)">
        <div class="modal-body">
          <input type="hidden" id="offer-candidate-id">
          
          <!-- Candidate Info Banner -->
          <div id="offer-candidate-info" style="background:linear-gradient(135deg,#e3f2fd,#e8eaf6);border-radius:16px;padding:20px;margin-bottom:25px;">
            <p style="color:#888;margin-bottom:5px;">Creating offer for:</p>
            <h3 id="offer-candidate-name" style="color:#1a1a2e;font-size:20px;margin-bottom:5px;">Select a candidate</h3>
            <p id="offer-candidate-job" style="color:#667eea;font-weight:500;"></p>
          </div>
          
          <!-- Tabs -->
          <div class="tabs">
            <button type="button" class="tab-btn active" onclick="switchOfferTab('offer-details-tab', this)">
              <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">work</i> Position Details
            </button>
            <button type="button" class="tab-btn" onclick="switchOfferTab('offer-salary-tab', this)">
              <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">payments</i> Compensation
            </button>
            <button type="button" class="tab-btn" onclick="switchOfferTab('offer-terms-tab', this)">
              <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">gavel</i> Terms
            </button>
            <button type="button" class="tab-btn" onclick="switchOfferTab('offer-preview-tab', this)">
              <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">preview</i> Preview
            </button>
          </div>
          
          <!-- Position Details Tab -->
          <div id="offer-details-tab" class="tab-content active">
            <div class="form-grid">
              <div class="form-group">
                <label><i class="material-icons">business</i> Legal Entity *</label>
                <select id="offer-entity" required>
                  <option value="">Select Entity</option>
                </select>
              </div>
              <div class="form-group">
                <label><i class="material-icons">work</i> Designation *</label>
                <input type="text" id="offer-designation" required placeholder="e.g., Software Engineer">
              </div>
              <div class="form-group">
                <label><i class="material-icons">category</i> Department *</label>
                <input type="text" id="offer-department" required placeholder="e.g., Engineering">
              </div>
              <div class="form-group">
                <label><i class="material-icons">location_on</i> Work Location *</label>
                <input type="text" id="offer-location" required placeholder="e.g., Mumbai">
              </div>
              <div class="form-group">
                <label><i class="material-icons">schedule</i> Employment Type *</label>
                <select id="offer-employment-type" required>
                  <option value="Full-time">Full-time</option>
                  <option value="Part-time">Part-time</option>
                  <option value="Contract">Contract</option>
                  <option value="Intern">Intern</option>
                </select>
              </div>
              <div class="form-group">
                <label><i class="material-icons">supervisor_account</i> Reporting Manager</label>
                <select id="offer-manager">
                  <option value="">Select Manager</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Compensation Tab -->
          <div id="offer-salary-tab" class="tab-content">
            <div class="salary-summary">
              <div class="salary-box ctc">
                <span class="salary-label">Annual CTC</span>
                <span class="salary-value" id="offer-ctc-display">â‚¹ 0</span>
              </div>
              <div class="salary-box gross">
                <span class="salary-label">Monthly CTC</span>
                <span class="salary-value" id="offer-monthly-display">â‚¹ 0</span>
              </div>
              <div class="salary-box net">
                <span class="salary-label">Basic Salary</span>
                <span class="salary-value" id="offer-basic-display">â‚¹ 0</span>
              </div>
            </div>
            
            <div class="salary-section">
              <h4><i class="material-icons">payments</i> Salary Breakdown</h4>
              <div class="form-grid">
                <div class="form-group">
                  <label>CTC (Annual) *</label>
                  <input type="number" id="offer-ctc-annual" required step="0.01" min="0" oninput="calculateOfferSalary()" placeholder="Enter annual CTC">
                </div>
                <div class="form-group">
                  <label>CTC (Monthly)</label>
                  <input type="number" id="offer-ctc-monthly" readonly class="readonly-input">
                </div>
                <div class="form-group">
                  <label>Basic Salary (Monthly)</label>
                  <input type="number" id="offer-basic" step="0.01" min="0" oninput="updateOfferSalaryDisplay()" placeholder="Basic salary">
                </div>
                <div class="form-group">
                  <label>HRA (Monthly)</label>
                  <input type="number" id="offer-hra" step="0.01" min="0" placeholder="HRA">
                </div>
                <div class="form-group">
                  <label>Other Allowances</label>
                  <input type="number" id="offer-other-allowances" step="0.01" min="0" placeholder="Other allowances">
                </div>
              </div>
              <div style="margin-top:15px;">
                <button type="button" class="btn btn-secondary" onclick="autoCalculateOfferSalary()">
                  <i class="material-icons">calculate</i> Auto Calculate Components
                </button>
              </div>
            </div>
          </div>
          
          <!-- Terms Tab -->
          <div id="offer-terms-tab" class="tab-content">
            <div class="form-grid">
              <div class="form-group">
                <label><i class="material-icons">event</i> Joining Date *</label>
                <input type="date" id="offer-joining-date" required>
              </div>
              <div class="form-group">
                <label><i class="material-icons">hourglass_empty</i> Probation Period</label>
                <select id="offer-probation">
                  <option value="3 months">3 months</option>
                  <option value="6 months" selected>6 months</option>
                  <option value="1 year">1 year</option>
                  <option value="Not Applicable">Not Applicable</option>
                </select>
              </div>
              <div class="form-group">
                <label><i class="material-icons">event_busy</i> Offer Valid Until *</label>
                <input type="date" id="offer-validity-date" required>
              </div>
              <div class="form-group">
                <label><i class="material-icons">timer</i> Response Deadline</label>
                <input type="date" id="offer-acceptance-deadline">
              </div>
            </div>
          </div>
          
          <!-- Preview Tab -->
          <div id="offer-preview-tab" class="tab-content">
            <div class="offer-preview">
              <div class="offer-preview-header">
                <h3>Offer Letter Preview</h3>
                <p>Review the offer details before sending</p>
              </div>
              <div class="offer-detail-grid" id="offer-preview-content">
                <!-- Will be populated dynamically -->
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('create-offer-modal')">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="saveOfferAsDraft()">
            <i class="material-icons">save</i> Save as Draft
          </button>
          <button type="submit" class="btn btn-success">
            <i class="material-icons">send</i> Create & Send Offer
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: View Offer (NEW)
       ============================================ -->
  <div id="view-offer-modal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#0f0c29,#302b63);">
          <h2><i class="material-icons">description</i> Offer Details</h2>
          <p id="view-offer-id">Offer ID: -</p>
          <button class="close-btn" onclick="closeModal('view-offer-modal')">&times;</button>
        </div>
      </div>
      <div class="modal-body" id="view-offer-content">
        <p class="loading-cell">Loading...</p>
      </div>
      <div class="modal-footer" id="view-offer-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('view-offer-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- ============================================
       MODAL: Bulk Upload
       ============================================ -->
  <div id="bulk-upload-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#f093fb,#f5576c);">
          <h2><i class="material-icons">upload_file</i> Bulk Upload Employees</h2>
          <p>Upload multiple employees at once via CSV</p>
          <button class="close-btn" onclick="closeModal('bulk-upload-modal')">&times;</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label><i class="material-icons">business</i> Legal Entity *</label>
          <select id="bulk-entity" required>
            <option value="">Select Entity</option>
            <? if(legalEntities && legalEntities.length > 0) { ?>
              <? for(var i = 0; i < legalEntities.length; i++) { ?>
                <option value="<?= legalEntities[i]['Entity Name'] ?>"><?= legalEntities[i]['Entity Name'] ?></option>
              <? } ?>
            <? } ?>
          </select>
        </div>
        <div class="form-group">
          <label><i class="material-icons">cloud_upload</i> Upload CSV File</label>
          <input type="file" id="bulk-csv" accept=".csv" onchange="previewCSV(event)" style="padding:12px;border:2px dashed #ddd;border-radius:10px;width:100%;">
          <p class="help-text" style="margin-top:8px;">CSV columns: First Name, Last Name, Personal Email, Phone, Aadhar Number, PAN Number</p>
        </div>
        <div id="csv-preview" style="margin-top:15px;max-height:200px;overflow:auto;border-radius:10px;"></div>
        <a href="javascript:void(0)" onclick="downloadCSVTemplate()" style="display:inline-flex;align-items:center;gap:5px;margin-top:15px;color:#667eea;text-decoration:none;font-weight:500;">
          <i class="material-icons">download</i> Download Template
        </a>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('bulk-upload-modal')">Cancel</button>
        <button type="button" class="btn btn-warning" onclick="processBulkUpload()">
          <i class="material-icons">cloud_upload</i> Upload Employees
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       MODAL: Add Entity
       ============================================ -->
  <div id="add-entity-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#11998e,#38ef7d);">
          <h2 id="entity-modal-title"><i class="material-icons">business</i> Add Legal Entity</h2>
          <p>Configure a new legal entity</p>
          <button class="close-btn" onclick="closeModal('add-entity-modal')">&times;</button>
        </div>
      </div>
      <form id="entity-form" onsubmit="submitEntity(event)">
        <input type="hidden" id="entity-id" value="">
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group">
              <label><i class="material-icons">business</i> Entity Name *</label>
              <input type="text" id="entity-name" required placeholder="Company Name Pvt Ltd">
            </div>
            <div class="form-group">
              <label><i class="material-icons">code</i> Entity Code *</label>
              <input type="text" id="entity-code" required placeholder="COMP" style="text-transform:uppercase">
            </div>
            <div class="form-group full-width">
              <label><i class="material-icons">location_on</i> Registered Address</label>
              <textarea id="entity-address" rows="2" placeholder="Complete address"></textarea>
            </div>
            <div class="form-group">
              <label><i class="material-icons">email</i> Contact Email</label>
              <input type="email" id="entity-email" placeholder="contact@company.com">
            </div>
            <div class="form-group">
              <label><i class="material-icons">phone</i> Contact Phone</label>
              <input type="tel" id="entity-phone" placeholder="9876543210">
            </div>
            <div class="form-group">
              <label><i class="material-icons">receipt</i> GST Number</label>
              <input type="text" id="entity-gst" placeholder="22AAAAA0000A1Z5" style="text-transform:uppercase">
            </div>
            <div class="form-group">
              <label><i class="material-icons">assignment</i> CIN Number</label>
              <input type="text" id="entity-cin" placeholder="U12345MH2020PTC123456" style="text-transform:uppercase">
            </div>
            <div class="form-group" id="entity-status-group" style="display:none">
              <label><i class="material-icons">toggle_on</i> Status</label>
              <select id="entity-status">
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal('add-entity-modal')">Cancel</button>
          <button type="submit" class="btn btn-success" id="entity-submit-btn">
            <i class="material-icons">add</i> Add Entity
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============================================
       MODAL: View Employee
       ============================================ -->
  <div id="view-employee-modal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <div class="modal-header-bg">
          <h2><i class="material-icons">person</i> Employee Details</h2>
          <p id="view-emp-name">-</p>
          <button class="close-btn" onclick="closeModal('view-employee-modal')">&times;</button>
        </div>
      </div>
      <div class="modal-body" id="employee-details-content">
        <p class="loading-cell">Loading...</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('view-employee-modal')">Close</button>
        <button type="button" class="btn btn-primary" id="edit-emp-btn" onclick="editEmployeeFromView()">
          <i class="material-icons">edit</i> Edit
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================
       MODAL: View Candidate
       ============================================ -->
  <div id="view-candidate-modal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <div class="modal-header-bg" style="background:linear-gradient(135deg,#11998e,#38ef7d);">
          <h2><i class="material-icons">person</i> Candidate Details</h2>
          <p id="view-cand-name">-</p>
          <button class="close-btn" onclick="closeModal('view-candidate-modal')">&times;</button>
        </div>
      </div>
      <div class="modal-body" id="candidate-details-content">
        <p class="loading-cell">Loading...</p>
      </div>
      <div class="modal-footer" id="candidate-modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('view-candidate-modal')">Close</button>
      </div>
    </div>
  </div>

  <!-- ============================================
       MODAL: Edit Employee (Large with tabs)
       ============================================ -->
  <div id="edit-employee-modal" class="modal">
    <div class="modal-content modal-xl">
      <div class="modal-header">
        <div class="modal-header-bg">
          <h2><i class="material-icons">edit</i> Edit Employee Information</h2>
          <p id="edit-emp-header-name">-</p>
          <button class="close-btn" onclick="closeModal('edit-employee-modal')">&times;</button>
        </div>
      </div>
      <div class="modal-body">
        <!-- Tabs -->
        <div class="tabs">
          <button type="button" class="tab-btn active" onclick="switchTab('basic-info-tab', this)">
            <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">person</i> Basic
          </button>
          <button type="button" class="tab-btn" onclick="switchTab('official-info-tab', this)">
            <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">work</i> Official
          </button>
          <button type="button" class="tab-btn" onclick="switchTab('salary-info-tab', this)">
            <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">payments</i> Salary
          </button>
          <button type="button" class="tab-btn" onclick="switchTab('personal-info-tab', this)">
            <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">badge</i> Personal
          </button>
          <button type="button" class="tab-btn" onclick="switchTab('bank-info-tab', this)">
            <i class="material-icons" style="font-size:18px;vertical-align:middle;margin-right:5px;">account_balance</i> Bank
          </button>
        </div>
        
        <form id="edit-employee-form">
          <input type="hidden" id="edit-emp-id">
          
          <!-- Basic Info Tab -->
          <div id="basic-info-tab" class="tab-content active">
            <h3 class="tab-section-title"><i class="material-icons">person</i> Basic Information</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Employee ID</label>
                <input type="text" id="edit-emp-id-display" readonly class="readonly-input">
              </div>
              <div class="form-group">
                <label>Legal Entity</label>
                <select id="edit-emp-entity"></select>
              </div>
              <div class="form-group">
                <label>First Name *</label>
                <input type="text" id="edit-emp-first-name" required>
              </div>
              <div class="form-group">
                <label>Last Name *</label>
                <input type="text" id="edit-emp-last-name" required>
              </div>
              <div class="form-group">
                <label>Personal Email *</label>
                <input type="email" id="edit-emp-personal-email" required>
              </div>
              <div class="form-group">
                <label>Official Email</label>
                <input type="email" id="edit-emp-official-email">
              </div>
              <div class="form-group">
                <label>Phone *</label>
                <input type="tel" id="edit-emp-phone" required>
              </div>
              <div class="form-group">
                <label>Alternate Phone</label>
                <input type="tel" id="edit-emp-alt-phone">
              </div>
              <div class="form-group">
                <label>Aadhar Number</label>
                <input type="text" id="edit-emp-aadhar">
              </div>
              <div class="form-group">
                <label>PAN Number</label>
                <input type="text" id="edit-emp-pan" style="text-transform:uppercase">
              </div>
              <div class="form-group">
                <label>Status</label>
                <select id="edit-emp-status">
                  <option value="Invited">Invited</option>
                  <option value="Form Pending">Form Pending</option>
                  <option value="Documents Pending">Documents Pending</option>
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                  <option value="Terminated">Terminated</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Official Info Tab -->
          <div id="official-info-tab" class="tab-content">
            <h3 class="tab-section-title"><i class="material-icons">work</i> Official Information</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Department *</label>
                <input type="text" id="edit-emp-department" list="departments-list" placeholder="Select or type">
                <datalist id="departments-list"></datalist>
              </div>
              <div class="form-group">
                <label>Designation *</label>
                <input type="text" id="edit-emp-designation" list="designations-list" placeholder="Select or type">
                <datalist id="designations-list"></datalist>
              </div>
              <div class="form-group">
                <label>Date of Joining *</label>
                <input type="date" id="edit-emp-doj">
              </div>
              <div class="form-group">
                <label>Reporting Manager</label>
                <select id="edit-emp-manager"></select>
              </div>
              <div class="form-group">
                <label>Employment Type *</label>
                <select id="edit-emp-employment-type">
                  <option value="">Select Type</option>
                  <option value="Full-time">Full-time</option>
                  <option value="Part-time">Part-time</option>
                  <option value="Contract">Contract</option>
                  <option value="Intern">Intern</option>
                  <option value="Trainee">Trainee</option>
                  <option value="Consultant">Consultant</option>
                </select>
              </div>
              <div class="form-group">
                <label>Work Location *</label>
                <input type="text" id="edit-emp-work-location" list="locations-list" placeholder="Select or type">
                <datalist id="locations-list"></datalist>
              </div>
              <div class="form-group">
                <label>Shift</label>
                <select id="edit-emp-shift">
                  <option value="">Select Shift</option>
                  <option value="General Shift">General Shift</option>
                  <option value="Morning Shift">Morning Shift</option>
                  <option value="Day Shift">Day Shift</option>
                  <option value="Evening Shift">Evening Shift</option>
                  <option value="Night Shift">Night Shift</option>
                  <option value="Rotational Shift">Rotational Shift</option>
                  <option value="Flexible">Flexible</option>
                </select>
              </div>
              <div class="form-group">
                <label>Probation End Date</label>
                <input type="date" id="edit-emp-probation-end">
              </div>
            </div>
            <div style="margin-top:20px;display:flex;justify-content:flex-end;">
              <button type="button" class="btn btn-success" onclick="saveOfficialInfo()">
                <i class="material-icons">save</i> Save Official Info
              </button>
            </div>
          </div>
          
          <!-- Salary Info Tab -->
          <div id="salary-info-tab" class="tab-content">
            <h3 class="tab-section-title"><i class="material-icons">payments</i> Salary & Compensation</h3>
            
            <div class="salary-summary">
              <div class="salary-box ctc">
                <span class="salary-label">CTC (Annual)</span>
                <span class="salary-value" id="salary-ctc-display">â‚¹ 0</span>
              </div>
              <div class="salary-box gross">
                <span class="salary-label">Gross Monthly</span>
                <span class="salary-value" id="salary-gross-display">â‚¹ 0</span>
              </div>
              <div class="salary-box net">
                <span class="salary-label">Net Monthly</span>
                <span class="salary-value" id="salary-net-display">â‚¹ 0</span>
              </div>
            </div>
            
            <div class="salary-section">
              <h4><i class="material-icons">trending_up</i> Earnings</h4>
              <div class="form-grid">
                <div class="form-group">
                  <label>CTC (Annual) *</label>
                  <input type="number" id="edit-emp-ctc-annual" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>CTC (Monthly)</label>
                  <input type="number" id="edit-emp-ctc-monthly" step="0.01" readonly class="readonly-input">
                </div>
                <div class="form-group">
                  <label>Basic Salary (Monthly)</label>
                  <input type="number" id="edit-emp-basic" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>HRA (Monthly)</label>
                  <input type="number" id="edit-emp-hra" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>Conveyance</label>
                  <input type="number" id="edit-emp-conveyance" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>Medical</label>
                  <input type="number" id="edit-emp-medical" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>Special Allowance</label>
                  <input type="number" id="edit-emp-special" step="0.01" min="0" oninput="calculateSalary()">
                </div>
                <div class="form-group">
                  <label>Other Allowances</label>
                  <input type="number" id="edit-emp-other-allowances" step="0.01" min="0" oninput="calculateSalary()">
                </div>
              </div>
            </div>
            
            <div class="salary-section">
              <h4><i class="material-icons">account_balance</i> Employer Contributions</h4>
              <div class="form-grid">
                <div class="form-group">
                  <label>PF (Employer)</label>
                  <input type="number" id="edit-emp-pf-employer" step="0.01" min="0">
                </div>
                <div class="form-group">
                  <label>ESI (Employer)</label>
                  <input type="number" id="edit-emp-esi-employer" step="0.01" min="0">
                </div>
                <div class="form-group">
                  <label>Gratuity</label>
                  <input type="number" id="edit-emp-gratuity" step="0.01" min="0">
                </div>
              </div>
            </div>
            
            <div class="salary-section">
              <h4><i class="material-icons">summarize</i> Summary</h4>
              <div class="form-grid">
                <div class="form-group">
                  <label>Gross Salary (Monthly)</label>
                  <input type="number" id="edit-emp-gross" step="0.01" readonly class="readonly-input" style="background:#e3f2fd;">
                </div>
                <div class="form-group">
                  <label>Net Salary (Monthly)</label>
                  <input type="number" id="edit-emp-net" step="0.01" oninput="updateSalaryDisplay()">
                </div>
              </div>
              <div class="form-group full-width" style="margin-top:15px;">
                <label>Salary Notes</label>
                <textarea id="edit-emp-salary-notes" rows="2" placeholder="Any notes about salary structure..."></textarea>
              </div>
            </div>
            
            <div style="margin-top:20px;display:flex;justify-content:flex-end;gap:10px;">
              <button type="button" class="btn btn-secondary" onclick="autoCalculateSalary()">
                <i class="material-icons">calculate</i> Auto Calculate
              </button>
              <button type="button" class="btn btn-success" onclick="saveSalaryInfo()">
                <i class="material-icons">save</i> Save Salary Info
              </button>
            </div>
          </div>
          
          <!-- Personal Info Tab -->
          <div id="personal-info-tab" class="tab-content">
            <h3 class="tab-section-title"><i class="material-icons">badge</i> Personal Information</h3>
            <div style="background:#fff3e0;border-radius:10px;padding:15px;margin-bottom:20px;display:flex;align-items:center;gap:10px;">
              <i class="material-icons" style="color:#e65100;">info</i>
              <span style="color:#e65100;font-size:13px;">This information is typically filled by the employee through the joining form.</span>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" id="edit-emp-dob">
              </div>
              <div class="form-group">
                <label>Gender</label>
                <select id="edit-emp-gender">
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label>Blood Group</label>
                <select id="edit-emp-blood-group">
                  <option value="">Select</option>
                  <option value="A+">A+</option><option value="A-">A-</option>
                  <option value="B+">B+</option><option value="B-">B-</option>
                  <option value="O+">O+</option><option value="O-">O-</option>
                  <option value="AB+">AB+</option><option value="AB-">AB-</option>
                </select>
              </div>
              <div class="form-group">
                <label>Marital Status</label>
                <select id="edit-emp-marital-status">
                  <option value="">Select</option>
                  <option value="Single">Single</option>
                  <option value="Married">Married</option>
                  <option value="Divorced">Divorced</option>
                  <option value="Widowed">Widowed</option>
                </select>
              </div>
              <div class="form-group">
                <label>Nationality</label>
                <input type="text" id="edit-emp-nationality">
              </div>
              <div class="form-group full-width">
                <label>Current Address</label>
                <textarea id="edit-emp-current-address" rows="2"></textarea>
              </div>
              <div class="form-group full-width">
                <label>Permanent Address</label>
                <textarea id="edit-emp-permanent-address" rows="2"></textarea>
              </div>
              <div class="form-group">
                <label>Emergency Contact Name</label>
                <input type="text" id="edit-emp-emergency-name">
              </div>
              <div class="form-group">
                <label>Emergency Phone</label>
                <input type="tel" id="edit-emp-emergency-phone">
              </div>
              <div class="form-group">
                <label>Emergency Relation</label>
                <input type="text" id="edit-emp-emergency-relation">
              </div>
            </div>
          </div>
          
          <!-- Bank Info Tab -->
          <div id="bank-info-tab" class="tab-content">
            <h3 class="tab-section-title"><i class="material-icons">account_balance</i> Bank Details</h3>
            <div style="background:#fff3e0;border-radius:10px;padding:15px;margin-bottom:20px;display:flex;align-items:center;gap:10px;">
              <i class="material-icons" style="color:#e65100;">info</i>
              <span style="color:#e65100;font-size:13px;">Bank details are typically filled by the employee through the joining form.</span>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>Bank Name</label>
                <input type="text" id="edit-emp-bank-name">
              </div>
              <div class="form-group">
                <label>Account Number</label>
                <input type="text" id="edit-emp-account-number">
              </div>
              <div class="form-group">
                <label>IFSC Code</label>
                <input type="text" id="edit-emp-ifsc" style="text-transform:uppercase">
              </div>
              <div class="form-group">
                <label>Account Holder Name</label>
                <input type="text" id="edit-emp-account-holder">
              </div>
              <div class="form-group">
                <label>UAN Number</label>
                <input type="text" id="edit-emp-uan">
              </div>
              <div class="form-group">
                <label>ESI Number</label>
                <input type="text" id="edit-emp-esi">
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeModal('edit-employee-modal')">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveAllEmployeeInfo()">
          <i class="material-icons">save</i> Save All Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p>Processing...</p>
  </div>

  <script>
    var WEB_APP_URL = '<?= webAppUrl ?>';
  </script>
  <?!= include('JavaScript'); ?>
</body>
</html>
