<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Employee Joining Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    
    .header {
      background: #2196F3;
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 { font-size: 24px; margin-bottom: 10px; }
    .header p { opacity: 0.9; }
    
    .form-container { padding: 30px; }
    
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }
    
    .progress-bar::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e0e0e0;
    }
    
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
      flex: 1;
    }
    
    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e0e0e0;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .step.active .step-number { background: #2196F3; color: white; }
    .step.completed .step-number { background: #4CAF50; color: white; }
    
    .step-label { font-size: 11px; color: #666; text-align: center; }
    
    .form-section { display: none; }
    .form-section.active { display: block; }
    
    .section-title {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #2196F3;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    
    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
      .step-label { font-size: 10px; }
    }
    
    .form-group { display: flex; flex-direction: column; }
    .form-group.full-width { grid-column: 1 / -1; }
    
    .form-group label {
      font-weight: 500;
      color: #555;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    .form-group label .required { color: #f44336; }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #2196F3;
    }
    
    .form-group input.readonly {
      background: #f5f5f5;
      color: #666;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    
    .documents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .document-item {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
    }
    
    .document-item h4 {
      font-size: 14px;
      margin-bottom: 10px;
      color: #333;
    }
    
    .document-upload {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .document-upload:hover {
      border-color: #2196F3;
      background: #f5f9ff;
    }
    
    .document-upload i {
      font-size: 32px;
      color: #2196F3;
    }
    
    .document-upload p {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .document-upload input { display: none; }
    
    .uploaded-file {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #e8f5e9;
      padding: 8px 12px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 13px;
    }
    
    .uploaded-file i { color: #4CAF50; }
    
    .uploaded-file .remove-file {
      margin-left: auto;
      color: #f44336;
      cursor: pointer;
    }
    
    .btn-group {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }
    
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .btn-primary { background: #2196F3; color: white; }
    .btn-primary:hover { background: #1976D2; }
    
    .btn-secondary { background: #e0e0e0; color: #333; }
    .btn-secondary:hover { background: #bdbdbd; }
    
    .btn-success { background: #4CAF50; color: white; }
    .btn-success:hover { background: #43A047; }
    
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    .success-section {
      text-align: center;
      padding: 60px 20px;
    }
    
    .success-section i {
      font-size: 80px;
      color: #4CAF50;
      margin-bottom: 20px;
    }
    
    .success-section h2 {
      color: #333;
      margin-bottom: 15px;
    }
    
    .success-section p {
      color: #666;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
    }
    
    .loading-overlay.active { display: flex; }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #2196F3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-overlay p {
      color: white;
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Employee Joining Form</h1>
      <p>Please complete all sections to finish your onboarding</p>
    </div>

    <div class="form-container">
      <!-- Progress Bar -->
      <div class="progress-bar">
        <div class="step active" data-step="1">
          <div class="step-number">1</div>
          <span class="step-label">Personal</span>
        </div>
        <div class="step" data-step="2">
          <div class="step-number">2</div>
          <span class="step-label">Address</span>
        </div>
        <div class="step" data-step="3">
          <div class="step-number">3</div>
          <span class="step-label">Emergency</span>
        </div>
        <div class="step" data-step="4">
          <div class="step-number">4</div>
          <span class="step-label">Bank</span>
        </div>
        <div class="step" data-step="5">
          <div class="step-number">5</div>
          <span class="step-label">Documents</span>
        </div>
      </div>

      <form id="joining-form">
        <input type="hidden" id="form-token" value="<?= token ?>">

        <!-- Section 1: Personal Information -->
        <div class="form-section active" data-section="1">
          <h3 class="section-title">Personal Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>First Name <span class="required">*</span></label>
              <input type="text" id="firstName" value="<?= employeeData['First Name'] || '' ?>" class="readonly" readonly>
            </div>
            <div class="form-group">
              <label>Last Name <span class="required">*</span></label>
              <input type="text" id="lastName" value="<?= employeeData['Last Name'] || '' ?>" class="readonly" readonly>
            </div>
            <div class="form-group">
              <label>Email <span class="required">*</span></label>
              <input type="email" id="email" value="<?= employeeData['Personal Email'] || '' ?>" class="readonly" readonly>
            </div>
            <div class="form-group">
              <label>Phone <span class="required">*</span></label>
              <input type="tel" id="phone" value="<?= employeeData['Phone'] || '' ?>" class="readonly" readonly>
            </div>
            <div class="form-group">
              <label>Alternate Phone</label>
              <input type="tel" id="alternatePhone" pattern="[0-9]{10}">
            </div>
            <div class="form-group">
              <label>Date of Birth <span class="required">*</span></label>
              <input type="date" id="dateOfBirth" required>
            </div>
            <div class="form-group">
              <label>Gender <span class="required">*</span></label>
              <select id="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Blood Group <span class="required">*</span></label>
              <select id="bloodGroup" required>
                <option value="">Select Blood Group</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
              </select>
            </div>
            <div class="form-group">
              <label>Marital Status <span class="required">*</span></label>
              <select id="maritalStatus" required>
                <option value="">Select Status</option>
                <option value="Single">Single</option>
                <option value="Married">Married</option>
                <option value="Divorced">Divorced</option>
                <option value="Widowed">Widowed</option>
              </select>
            </div>
            <div class="form-group">
              <label>Nationality</label>
              <input type="text" id="nationality" value="Indian">
            </div>
          </div>
        </div>

        <!-- Section 2: Address Information -->
        <div class="form-section" data-section="2">
          <h3 class="section-title">Address Information</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <label>Current Address <span class="required">*</span></label>
              <textarea id="currentAddress" rows="3" required placeholder="House No., Street, City, State, PIN Code"></textarea>
            </div>
            <div class="form-group full-width">
              <div class="checkbox-group">
                <input type="checkbox" id="sameAddress" onchange="copyAddress()">
                <label for="sameAddress">Permanent address same as current address</label>
              </div>
            </div>
            <div class="form-group full-width">
              <label>Permanent Address <span class="required">*</span></label>
              <textarea id="permanentAddress" rows="3" required placeholder="House No., Street, City, State, PIN Code"></textarea>
            </div>
          </div>
        </div>

        <!-- Section 3: Emergency Contact -->
        <div class="form-section" data-section="3">
          <h3 class="section-title">Emergency Contact</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Contact Name <span class="required">*</span></label>
              <input type="text" id="emergencyContactName" required>
            </div>
            <div class="form-group">
              <label>Relationship <span class="required">*</span></label>
              <select id="emergencyContactRelation" required>
                <option value="">Select Relationship</option>
                <option value="Father">Father</option>
                <option value="Mother">Mother</option>
                <option value="Spouse">Spouse</option>
                <option value="Sibling">Sibling</option>
                <option value="Friend">Friend</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label>Contact Phone <span class="required">*</span></label>
              <input type="tel" id="emergencyContactPhone" required pattern="[0-9]{10}">
            </div>
          </div>
        </div>

        <!-- Section 4: Bank Details -->
        <div class="form-section" data-section="4">
          <h3 class="section-title">Bank Details</h3>
          <div class="form-grid">
            <div class="form-group">
              <label>Bank Name <span class="required">*</span></label>
              <input type="text" id="bankName" required>
            </div>
            <div class="form-group">
              <label>Account Number <span class="required">*</span></label>
              <input type="text" id="accountNumber" required>
            </div>
            <div class="form-group">
              <label>IFSC Code <span class="required">*</span></label>
              <input type="text" id="ifscCode" required style="text-transform:uppercase">
            </div>
            <div class="form-group">
              <label>Account Holder Name <span class="required">*</span></label>
              <input type="text" id="accountHolderName" required>
            </div>
            <div class="form-group">
              <label>UAN Number (if available)</label>
              <input type="text" id="uanNumber">
            </div>
            <div class="form-group">
              <label>ESI Number (if available)</label>
              <input type="text" id="esiNumber">
            </div>
          </div>
        </div>

        <!-- Section 5: Document Upload -->
        <div class="form-section" data-section="5">
          <h3 class="section-title">Document Upload</h3>
          <p style="color:#666; margin-bottom:20px;">Upload clear scanned copies or photos. Accepted: PDF, JPG, PNG (Max 5MB each)</p>
          
          <div class="documents-grid">
            <div class="document-item">
              <h4>Passport Photo <span class="required">*</span></h4>
              <div class="document-upload" onclick="document.getElementById('doc-photo').click()">
                <i class="material-icons">photo_camera</i>
                <p>Click to upload</p>
                <input type="file" id="doc-photo" accept="image/*" onchange="handleFileUpload(this, 'Photo')">
              </div>
              <div id="doc-photo-preview"></div>
            </div>
            
            <div class="document-item">
              <h4>Aadhar Card <span class="required">*</span></h4>
              <div class="document-upload" onclick="document.getElementById('doc-aadhar').click()">
                <i class="material-icons">credit_card</i>
                <p>Click to upload</p>
                <input type="file" id="doc-aadhar" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'Aadhar Card')">
              </div>
              <div id="doc-aadhar-preview"></div>
            </div>
            
            <div class="document-item">
              <h4>PAN Card <span class="required">*</span></h4>
              <div class="document-upload" onclick="document.getElementById('doc-pan').click()">
                <i class="material-icons">credit_card</i>
                <p>Click to upload</p>
                <input type="file" id="doc-pan" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'PAN Card')">
              </div>
              <div id="doc-pan-preview"></div>
            </div>
            
            <div class="document-item">
              <h4>10th Certificate</h4>
              <div class="document-upload" onclick="document.getElementById('doc-10th').click()">
                <i class="material-icons">school</i>
                <p>Click to upload</p>
                <input type="file" id="doc-10th" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, '10th Certificate')">
              </div>
              <div id="doc-10th-preview"></div>
            </div>
            
            <div class="document-item">
              <h4>12th Certificate</h4>
              <div class="document-upload" onclick="document.getElementById('doc-12th').click()">
                <i class="material-icons">school</i>
                <p>Click to upload</p>
                <input type="file" id="doc-12th" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, '12th Certificate')">
              </div>
              <div id="doc-12th-preview"></div>
            </div>
            
            <div class="document-item">
              <h4>Degree Certificate</h4>
              <div class="document-upload" onclick="document.getElementById('doc-degree').click()">
                <i class="material-icons">school</i>
                <p>Click to upload</p>
                <input type="file" id="doc-degree" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'Degree Certificate')">
              </div>
              <div id="doc-degree-preview"></div>
            </div>
          </div>
        </div>

        <!-- Success Section -->
        <div class="form-section" data-section="success">
          <div class="success-section">
            <i class="material-icons">check_circle</i>
            <h2>Form Submitted Successfully!</h2>
            <p>Thank you for completing your joining form. Our HR team will review your submission and contact you soon.</p>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="btn-group" id="btn-group">
          <button type="button" class="btn btn-secondary" id="prevBtn" onclick="changeSection(-1)" style="display:none">
            <i class="material-icons">arrow_back</i> Previous
          </button>
          <div style="flex:1"></div>
          <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeSection(1)">
            Next <i class="material-icons">arrow_forward</i>
          </button>
          <button type="button" class="btn btn-success" id="submitBtn" onclick="submitForm()" style="display:none">
            <i class="material-icons">check</i> Submit Form
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="loading-overlay" id="loading">
    <div class="spinner"></div>
    <p>Submitting your form...</p>
  </div>

  <script>
    var currentSection = 1;
    var totalSections = 5;
    var uploadedDocuments = [];

    function changeSection(direction) {
      // Validate current section
      if (direction === 1 && !validateSection(currentSection)) {
        return;
      }

      var sections = document.querySelectorAll('.form-section');
      var steps = document.querySelectorAll('.step');

      if (direction === 1 && currentSection < totalSections) {
        steps[currentSection - 1].classList.remove('active');
        steps[currentSection - 1].classList.add('completed');
        currentSection++;
      } else if (direction === -1 && currentSection > 1) {
        currentSection--;
        steps[currentSection].classList.remove('completed');
      }

      // Show current section
      sections.forEach(function(section) {
        section.classList.remove('active');
      });
      document.querySelector('[data-section="' + currentSection + '"]').classList.add('active');

      // Update step indicators
      steps.forEach(function(step, index) {
        if (index + 1 === currentSection) {
          step.classList.add('active');
        } else if (index + 1 !== currentSection) {
          step.classList.remove('active');
        }
      });

      // Update buttons
      document.getElementById('prevBtn').style.display = currentSection === 1 ? 'none' : 'flex';
      document.getElementById('nextBtn').style.display = currentSection === totalSections ? 'none' : 'flex';
      document.getElementById('submitBtn').style.display = currentSection === totalSections ? 'flex' : 'none';

      window.scrollTo(0, 0);
    }

    function validateSection(section) {
      var sectionEl = document.querySelector('[data-section="' + section + '"]');
      var inputs = sectionEl.querySelectorAll('input[required], select[required], textarea[required]');
      var isValid = true;

      inputs.forEach(function(input) {
        if (!input.value.trim()) {
          input.style.borderColor = '#f44336';
          isValid = false;
        } else {
          input.style.borderColor = '#ddd';
        }
      });

      if (!isValid) {
        alert('Please fill in all required fields.');
      }

      return isValid;
    }

    function copyAddress() {
      if (document.getElementById('sameAddress').checked) {
        document.getElementById('permanentAddress').value = document.getElementById('currentAddress').value;
      } else {
        document.getElementById('permanentAddress').value = '';
      }
    }

    function handleFileUpload(input, docType) {
      var file = input.files[0];
      if (!file) return;

      if (file.size > 5 * 1024 * 1024) {
        alert('File size should be less than 5MB');
        input.value = '';
        return;
      }

      var reader = new FileReader();
      reader.onload = function(e) {
        var base64Content = e.target.result.split(',')[1];
        
        // Remove existing document of same type
        uploadedDocuments = uploadedDocuments.filter(function(d) {
          return d.type !== docType;
        });

        uploadedDocuments.push({
          type: docType,
          fileName: file.name,
          mimeType: file.type,
          content: base64Content
        });

        // Show preview
        var previewId = input.id + '-preview';
        document.getElementById(previewId).innerHTML = 
          '<div class="uploaded-file">' +
          '<i class="material-icons">insert_drive_file</i>' +
          '<span>' + file.name + '</span>' +
          '<i class="material-icons remove-file" onclick="removeFile(\'' + docType + '\', \'' + input.id + '\')">close</i>' +
          '</div>';
      };
      reader.readAsDataURL(file);
    }

    function removeFile(docType, inputId) {
      uploadedDocuments = uploadedDocuments.filter(function(d) {
        return d.type !== docType;
      });
      document.getElementById(inputId).value = '';
      document.getElementById(inputId + '-preview').innerHTML = '';
    }

    function submitForm() {
      // Validate required documents
      var requiredDocs = ['Photo', 'Aadhar Card', 'PAN Card'];
      var missingDocs = [];
      
      requiredDocs.forEach(function(doc) {
        var found = uploadedDocuments.some(function(d) {
          return d.type === doc;
        });
        if (!found) {
          missingDocs.push(doc);
        }
      });

      if (missingDocs.length > 0) {
        alert('Please upload required documents: ' + missingDocs.join(', '));
        return;
      }

      document.getElementById('loading').classList.add('active');

      var formData = {
        token: document.getElementById('form-token').value,
        dateOfBirth: document.getElementById('dateOfBirth').value,
        gender: document.getElementById('gender').value,
        bloodGroup: document.getElementById('bloodGroup').value,
        maritalStatus: document.getElementById('maritalStatus').value,
        nationality: document.getElementById('nationality').value,
        alternatePhone: document.getElementById('alternatePhone').value,
        currentAddress: document.getElementById('currentAddress').value,
        permanentAddress: document.getElementById('permanentAddress').value,
        emergencyContactName: document.getElementById('emergencyContactName').value,
        emergencyContactPhone: document.getElementById('emergencyContactPhone').value,
        emergencyContactRelation: document.getElementById('emergencyContactRelation').value,
        bankName: document.getElementById('bankName').value,
        accountNumber: document.getElementById('accountNumber').value,
        ifscCode: document.getElementById('ifscCode').value,
        accountHolderName: document.getElementById('accountHolderName').value,
        uanNumber: document.getElementById('uanNumber').value,
        esiNumber: document.getElementById('esiNumber').value,
        documents: uploadedDocuments
      };

      google.script.run
        .withSuccessHandler(function(result) {
          document.getElementById('loading').classList.remove('active');
          if (result.success) {
            document.getElementById('btn-group').style.display = 'none';
            document.querySelectorAll('.form-section').forEach(function(s) {
              s.classList.remove('active');
            });
            document.querySelector('[data-section="success"]').classList.add('active');
          } else {
            alert('Error: ' + (result.error || 'Unknown error'));
          }
        })
        .withFailureHandler(function(error) {
          document.getElementById('loading').classList.remove('active');
          alert('Error: ' + error);
        })
        .submitJoiningForm(formData);
    }
  </script>
</body>
</html>
